# MySQL 事务

## 1、事务概述

什么是事务？

一个事务是一个完整得业务逻辑单元，不可再分。

比如：银行账户转账，从A账户向B账户转账10000.需要执行两条update语句
```
update t_act set balance = balance - 10000 where actno = ‘act001’
update t_act set balance = balance - 10000 where actno = ‘act001’
```
以上两条DML语句必须同时成功，或者同时失败，不允许出现一条成功，一条失败。
要保证以上两条DML语句得同时成功和失败，就需要使用数据库得事务机制。

和事务相关得语句只有：DML语句。(insert，delete，update)为什么？

因为他们这三个语句都是和数据库表当中得数据相关得。事物的存在是为了保证数据得完整性，安全性。

## 2、事务特性

事务包括四大特性：ACID

A：原子性：事务是最小的工作单元，不可再分。
B：一致性：事务必须保证多条DML语句同时成功或者同时失败。
C：隔离性：事务A与事务B之间具有隔离。
D：持久性：持久性说的是最终数据必须持久化到硬盘文件中，事务才算成功的结束。

## 3、事务隔离级别

事务隔离性村子啊隔离级别，理论上隔离级别包括4个：

第一级别：读未提交（READ UNCOMMITTED）：对方事务还没有提交，我们那当前事务就可以读取到对方未提交的数据。读未提交存在脏读现象：表示读到了脏的数据。
第二级别：读已提交（READ COMMITTED）：对方事务提交之后的数据我方可以读取到。这种隔离级别解决了脏读现象。存在的问题：不可重复读。
第三级别：可重复读（REPEATABLE READ）这种隔离级别解决了：不可重复读问题。存在问题：读取到的数据是幻象。
第四级别：序列化/串行话读（SERIALIZABLE），解决所有的问题，但效率低。需要事务排队。

## 备注

- Oracle数据库默认的隔离级别是读已提交
- MySQL数据库默认的隔离级是可重复读
- MySQL8查询事务应该使用transaction_isolation，tx_isolation在MySQL 5.7.20后被弃用。

```
show variables like 'transaction_isolation';
```